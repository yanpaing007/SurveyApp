<div th:replace="~{fragments/layout::layout(~{::section})}">

    <section class="mx-auto w-[95%] md:w-[90%] py-2">
        <div class="py-3 flex flex-col-reverse lg:flex-row gap-3">
            <div class="flex-5 survey-details shadow-md relative py-5 px-2">
                <div class="w-full bg-gradient-to-r from-indigo-500 via-purple-500 to-indigo-500 h-2 rounded-t-md absolute top-0 left-0"></div>
                <div class="header-section flex flex-row justify-between items-start md:items-center gap-y-4 px-5 pt-3">
                    <div class="flex flex-col md:flex-row items-start md:items-center gap-2">
                        <p class="text-lg md:text-xl font-semibold text-indigo-700">Survey Details</p>
                        <span
                                th:text="${survey.generatedSurveyId}"
                                class="text-indigo-800 bg-indigo-100 px-3 py-1 text-xs rounded-xl">
                  </span>
                    </div>

                    <div class="flex items-center gap-x-1 text-xs rounded-xl border px-4 py-1 text-center"
                         th:classappend="${survey.status.name() == 'PENDING' ? 'text-yellow-600 bg-yellow-50 border-yellow-400' :
                           survey.status.name() == 'SUCCEEDED' ? 'text-green-600 bg-green-50 border-green-400' :
                           survey.status.name() == 'FAILED' ? 'text-red-600 bg-red-50 border-red-400' : ''}">
                        <div class="w-2 h-2 rounded-full"></div>
                        <i th:class="${survey.status.name() == 'PENDING'    ? 'fa-solid fa-hourglass-half text-yellow-500' :
                          survey.status.name() == 'SUCCEEDED'  ? 'fa-solid fa-circle-check text-green-500' :
                          survey.status.name() == 'FAILED'  ? 'fa-solid fa-circle-xmark text-red-500' :
                          'fa-solid fa-question-circle'}"></i>
                        <p th:text="${survey.status.name()}"></p>
                    </div>
                </div>
                <div class="survey-details-body px-5 py-4">
                    <form method="post"
                          th:action="@{/technical/survey/edit/{id}(id=${survey.getGeneratedSurveyId()})}"
                    th:object="${survey}">
                        <div class="wild-card flex flex-col gap-y-3 mt-2">
                            <input type="hidden" th:field="*{technicalPerson}">

                            <div class="flex flex-row items-center gap-x-2">
                                <i class="fa-solid fa-exclamation-circle text-indigo-500"></i>
                                <p>Basic Information</p>
                            </div>
                            <hr class="h-1 text-gray-200">

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                                <div th:replace="~{fragments/survey/non-editable-input::none-editable-input('Generated Survey Id',*{generatedSurveyId},'generatedSurveyId','fa-solid fa-clipboard-list',false,true)}">
                                </div>

                                <div th:replace="~{fragments/survey/non-editable-input::none-editable-input('Customer Name',*{customerName},'customerName','fa-solid fa-user',false,false)}">
                                </div>


                                <div th:replace="~{fragments/survey/non-editable-input::none-editable-input('Sale Person',*{salePerson.fullName},'salePerson','fa-solid fa-user-tie',true,true)}">
                                </div>

                                <input type="hidden" th:value="${survey.technicalPerson.fullName}" name="state" id="techName">
                                <div th:replace="~{fragments/survey/non-editable-input::none-editable-input('Technical Person',*{technicalPerson != null ? technicalPerson.fullName : 'Not Assigned'},'technicalPerson','fa-solid fa-user-secret',true,true)}">
                                </div>
                            </div>
                        </div>

                        <div class="wild-card flex flex-col gap-y-2 mt-5">
                            <div class="flex flex-row items-center gap-x-2 pt-3">
                                <i class="fa-solid fa-map text-indigo-500"></i>
                                <p>Location Information</p>
                            </div>
                            <hr class="h-1 text-gray-200">

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="flex flex-col gap-y-1">
                                    <label for="state"
                                           class="text-xs font-light">
                                        State
                                    </label>
                                    <div class="relative" id="stateDiv">
                                        <div class="absolute inset-y-0 left-0 flex items-center ps-3.5 pointer-events-none z-10">
                                            <i class="fa-solid fa-tower-observation text-gray-900"></i>
                                        </div>
                                        <select th:field="*{state}" id="state" name="state" class="select2-state w-full ps-10 p-2 text-sm rounded-lg border border-gray-300 bg-white text-gray-800">
                                            <option th:value="${survey.state}" th:text="${survey.state}">Select State</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="flex flex-col gap-y-1">
                                    <label for="townShip"
                                           class="text-xs font-light">
                                        TownShip
                                    </label>
                                    <div class="relative" id="townShipDiv">
                                        <div class="absolute inset-y-0 left-0 flex items-center ps-3.5 pointer-events-none z-10">
                                            <i class="fa-solid fa-city text-gray-900"></i>
                                        </div>
                                        <select th:field="*{townShip}" id="townShip" name="townShip" class="select2-township w-full focus:outline-hidden text-sm rounded-lg p-2 border border-gray-300 bg-white text-gray-800">
                                            <option th:value="${survey.townShip}" th:text="${survey.townShip}"></option>
                                        </select>
                                    </div>
                                </div>


                                <div th:replace="~{fragments/survey/non-editable-input::none-editable-input('Longitude',*{longitude},'longitude','fa-solid fa-location',false,false)}">
                                </div>


                                <div th:replace="~{fragments/survey/non-editable-input::none-editable-input('Latitude',*{latitude},'latitude','fa-solid fa-location-dot',false,false)}">
                                </div>
                            </div>
                        </div>

                        <div class="wild-card flex flex-col gap-y-2 mt-5">
                            <div class="flex flex-row items-center gap-x-2 pt-3">
                                <i class="fa-solid fa-circle-info text-indigo-500"></i>
                                <p>More Information</p>
                            </div>
                            <hr class="h-1 text-gray-200">

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                                <div th:replace="~{fragments/survey/non-editable-input::none-editable-input('Customer`s Number',*{phoneNumber},'phoneNumber','fa-solid fa-phone',false,false)}">
                                </div>

                                <div class="flex flex-col gap-y-1">
                                    <label for="status"
                                           class="text-xs font-light">
                                        Update Status
                                    </label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 start-0 flex items-center ps-3">
                                            <i class="fa-solid fa-square-poll-horizontal"></i>
                                        </div>

                                        <select name="status" id="status" th:field="*{status}"
                                                class="form-select w-full focus:outline-hidden text-xs rounded-lg ps-7 p-3 border border-gray-200">

                                            <option th:each="status : ${statuses}"
                                                    th:value="${status}"
                                                    th:text="${status}"
                                                    th:selected="${status == survey.status}">
                                            </option>

                                        </select>
                                    </div>
                                </div>

                                <div th:replace="~{fragments/survey/non-editable-input::none-editable-input('UpdateAt',${survey.updatedAt != null ? #temporals.format(survey.updatedAt,'EEEE, MMMM d, yyyy HH:mm a') : 'Not updated'},'updatedAt','fa-solid fa-calendar',true,true)}">
                                </div>

                                <div th:replace="~{fragments/survey/non-editable-input::none-editable-input('CreatedAt',*{#temporals.format(createdAt,'EEEE, MMMM d, yyyy HH:mm a')},'createdAt','fa-solid fa-calendar-days',true,true)}">
                                </div>
                            </div>
                        </div>

                        <div class="flex flex-row justify-between mt-8 text-sm">
                            <a th:if="${#authorization.expression('hasAnyAuthority(''Admin'',''Technical'')')}" th:href="@{/technical/survey/allSurvey}" class="px-4 py-2 bg-gray-600 text-white rounded-md flex items-center gap-2 cursor-pointer">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-big-left-dash-icon lucide-arrow-big-left-dash"><path d="M13 9a1 1 0 0 1-1-1V5.061a1 1 0 0 0-1.811-.75l-6.835 6.836a1.207 1.207 0 0 0 0 1.707l6.835 6.835a1 1 0 0 0 1.811-.75V16a1 1 0 0 1 1-1h2a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1z"/><path d="M20 9v6"/></svg>
                                    Back to surveys
                            </a>
                            <a th:if="${#authorization.expression('hasAuthority(''Sale'')')}" th:href="@{/sale/survey/allSurvey}" class="px-4 py-2 bg-gray-600 text-white rounded-md flex items-center gap-2 cursor-pointer">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-big-left-dash-icon lucide-arrow-big-left-dash"><path d="M13 9a1 1 0 0 1-1-1V5.061a1 1 0 0 0-1.811-.75l-6.835 6.836a1.207 1.207 0 0 0 0 1.707l6.835 6.835a1 1 0 0 0 1.811-.75V16a1 1 0 0 1 1-1h2a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1z"/><path d="M20 9v6"/></svg>
                                Back to surveys
                            </a>

                            <button th:if="${#authorization.expression('hasAnyAuthority(''Admin'',''Technical'')')}" type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md flex items-center gap-2 cursor-pointer btn-animated">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send-icon lucide-send"><path d="M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"/><path d="m21.854 2.147-10.94 10.939"/></svg>
                                Update Survey
                            </button>
                        </div>
                    </form>
                </div>

            </div>
            <div class="flex-5 survey-map h-[800px] shadow-md py-5 relative">
                <div class="w-full bg-gradient-to-r from-indigo-500 via-purple-500 to-indigo-500 h-2 rounded-t-md absolute top-0 left-0"></div>
                <div class="px-3">

                    <div class="surveyChartHeader flex flex-row items-center gap-x-2 pt-2 text-lg">
                        <i class="fa-solid fa-map text-indigo-700"></i>
                        Location Map
                    </div>
                    <hr class="my-2 w-full text-gray-200 rounded-t-md">

                    <div id="map" th:data-lat="${survey.latitude}"
                         th:data-lng="${survey.longitude}"
                         class="w-full rounded-lg border border-gray-300" style="height: 500px;"></div>
                    <div class="p-3 border border-gray-200 rounded-md text-sm mt-3">
                        <p class="font-base">Address</p>
                        <p class="font-light" th:text="${survey.state}+','+${survey.townShip}"></p>
                    </div>
                    <div class="flex flex-row gap-x-3">
                        <div class="p-3 border border-gray-200 rounded-md text-sm mt-3 flex-grow">
                            <p class="font-base">Longitude</p>
                            <p class="font-light" th:text="${survey.longitude}"></p>
                        </div>
                        <div class="p-3 border border-gray-200 rounded-md text-sm mt-3 flex-grow">
                            <p class="font-base">Latitude</p>
                            <p class="font-light" th:text="${survey.latitude}"></p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>

</div>

